<html lang="en">
  <head>
    <title>Find topics of a movie</title>

    <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
    <!--
    <link rel="canonical" href="http://www.example.com/">
    -->

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.indigo-pink.min.css">
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <script src='//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js'></script>
    <script src="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.min.js"></script>
    <script src="https://cdn.jsdelivr.net/vue/1.0.10/vue.min.js"></script>

    <style>
    html, body {
      font-family: 'Roboto', 'Helvetica', sans-serif;
      margin: 0;
      padding: 0;
    }
    .turk .mdl-layout__header-row {
      padding-left: 40px;
    }
    .turk .mdl-layout.is-small-screen .mdl-layout__header-row h3 {
      font-size: inherit;
    }
    .turk .mdl-layout__tab-bar-button {
      display: none;
    }
    .turk .mdl-layout.is-small-screen .mdl-layout__tab-bar .mdl-button {
      display: none;
    }
    .turk .mdl-layout:not(.is-small-screen) .mdl-layout__tab-bar,
    .turk .mdl-layout:not(.is-small-screen) .mdl-layout__tab-bar-container {
      overflow: visible;
    }
    .turk .mdl-layout__tab-bar-container {
      height: 64px;
    }
    .turk .mdl-layout__tab-bar {
      padding: 0;
      padding-left: 16px;
      box-sizing: border-box;
      height: 100%;
      width: 100%;
    }
    .turk .mdl-layout__tab-bar .mdl-layout__tab {
      height: 64px;
      line-height: 64px;
    }
    .turk .mdl-layout__tab-bar .mdl-layout__tab.is-active::after {
      background-color: white;
      height: 4px;
    }
    .turk main > .mdl-layout__tab-panel {
      padding: 8px;
      padding-top: 48px;
    }
    .turk .mdl-card {
      height: auto;
      display: flex;
      flex-direction: column;
    }
    .turk .mdl-card > * {
      height: auto;
    }
    .turk .mdl-card .mdl-card__supporting-text {
      margin: 40px;
      flex-grow: 1;
      padding: 0;
      color: inherit;
      width: calc(100% - 80px);
    }
    .turk.turk .mdl-card__supporting-text h4 {
      margin-top: 0;
      margin-bottom: 20px;
    }
    .turk .mdl-card__actions {
      margin: 0;
      padding: 4px 40px;
      color: inherit;
    }
    .turk .mdl-card__actions a {
      color: #00BCD4;
      margin: 0;
    }
    .turk .mdl-card__actions a:hover,
    .turk .mdl-card__actions a:active {
      color: inherit;
      background-color: transparent;
    }
    .turk .mdl-card__supporting-text + .mdl-card__actions {
      border-top: 1px solid rgba(0, 0, 0, 0.12);
    }
    .turk #add {
      position: absolute;
      right: 40px;
      top: 36px;
      z-index: 999;
    }

    .turk .mdl-layout__content section:not(:last-of-type) {
      position: relative;
      margin-top: 40px;
      margin-bottom: 48px;
    }
    .turk section.section--center {
      max-width: 940px;
    }
    .turk #features section.section--center {
      max-width: 620px;
    }
    .turk section > header{
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .turk section > .section__play-btn {
      min-height: 200px;
    }
    .turk section > header > .material-icons {
      font-size: 3rem;
    }
    .turk section > button {
      position: absolute;
      z-index: 99;
      top: 8px;
      right: 8px;
    }
    .turk section .section__circle {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      flex-grow: 0;
      flex-shrink: 1;
    }
    .turk section .section__text {
      flex-grow: 1;
      flex-shrink: 0;
      padding-top: 8px;
    }
    .turk section .section__text h5 {
      font-size: inherit;
      margin: 0;
      margin-bottom: 0.5em;
    }
    .turk section .section__text a {
      text-decoration: none;
    }
    .turk section .section__circle-container > .section__circle-container__circle {
      width: 64px;
      height: 64px;
      border-radius: 32px;
      margin: 8px 0;
    }
    .turk section.section--footer .section__circle--big {
      width: 100px;
      height: 100px;
      border-radius: 50px;
      margin: 8px 32px;
    }
    .turk .is-small-screen section.section--footer .section__circle--big {
      width: 50px;
      height: 50px;
      border-radius: 25px;
      margin: 8px 16px;
    }
    .turk section.section--footer {
      padding: 64px 0;
      margin: 0 -8px -8px -8px;
    }
    .turk section.section--center .section__text:not(:last-child) {
      border-bottom: 1px solid rgba(0,0,0,.13);
    }
    .turk .mdl-card .mdl-card__supporting-text > h3:first-child {
      margin-bottom: 24px;
    }
    .turk .mdl-layout__tab-panel:not(#overview) {
      background-color: white;
    }
    .turk #features section {
      margin-bottom: 72px;
    }
    .turk #features h4, #features h5 {
      margin-bottom: 16px;
    }
    .turk .toc {
      border-left: 4px solid #C1EEF4;
      margin: 24px;
      padding: 0;
      padding-left: 8px;
      display: flex;
      flex-direction: column;
    }
    .turk .toc h4 {
      font-size: 0.9rem;
      margin-top: 0;
    }
    .turk .toc a {
      color: #4DD0E1;
      text-decoration: none;
      font-size: 16px;
      line-height: 28px;
      display: block;
    }
    .turk .mdl-menu__container {
      z-index: 99;
    }
    .turk .question-table {
        margin-left: auto;
        margin-right: auto;
    }
    .turk .nav-buttons {
        margin-top: 20px;
        margin-bottom: 20px;
        padding-left: auto;
        padding-right: auto;
        text-align: center;
    }
    .turk .nav-buttons .button {
        margin-left: 10px;
    }
    .turk .table-text {
      font-size: 1.2em;
    }

    .turk .text {
      font-size: 1.2em;
    }

    .turk .question-section {
      min-height: 700px;
    }
    </style>
  </head>
  <body class="turk mdl-color--grey-100 mdl-color-text--grey-700 mdl-base">
    <div id="app">
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <header class="mdl-layout__header mdl-layout__header--scroll mdl-color--primary">
        <div class="mdl-layout--large-screen-only mdl-layout__header-row">
          <h3>Find topics of a movie</h3>
        </div>
      </header>
      <main class="mdl-layout__content">
        {% raw %}
        <section class="section--center mdl-grid mdl-grid--no-spacing mdl-shadow--2dp">
          <div class="mdl-card mdl-cell mdl-cell--12-col">
            <div class="mdl-card__supporting-text">
              <h3>Consent</h3>
              <p>We are a group of researchers from the University of Minnesota. We are conducting an academic study about recommending movies. In the survey below, you will be asked to identify key features of a movie.</p>

              <p><strong>Contact Information.</strong> This research (1411E56001) is approved by the Institutional&nbsp;Review Board&nbsp;at the University of Minnesota. You can contact the requester by emailing <a href="mailto:schang@cs.umn.edu">schang@cs.umn.edu</a>. If you have further concerns, you can contact the Institutional Review Board&nbsp;by emailing <a href="mailto:irb@umn.edu">irb@umn.edu</a> or calling 612-626-5654.</p>

              <p><strong>Privacy</strong> The records of this study will be kept private. In any sort of report we might publish, we will not include any information that will make it possible to identify a subject. Research records will be stored securely and only researchers will have access to the records.</p>
            </div>
          </div>
        </section>

        <section class="section--center mdl-grid mdl-grid--no-spacing mdl-shadow--2dp">
          <div class="mdl-card mdl-cell mdl-cell--12-col">
            <div class="mdl-card__supporting-text">
              <h3>Instructions</h3>
              <p class="text">
                Please look at the movie shown below, then answer the questions
                at the bottom of the page.
                It does not matter whether or not you have watched the movie;
                use your best judgment.
                Please answer all three questions (each question has several parts)
                before submitting the HIT.
                Some questions have verifiable answers that we will check before
                accepting the HIT.
              </p>
            </div>
          </div>
        </section>

          <section class="section--center mdl-grid mdl-grid--no-spacing mdl-shadow--2dp">
            <header class="mdl-cell mdl-cell--3-col-desktop mdl-color-text--white">
              <img class="img-responsive rounded ml4-bordered" src="{{posterSrc}}">
            </header>
            <div class="mdl-card mdl-cell mdl-cell--9-col-desktop">
              <div class="mdl-card__supporting-text">
                <h4>{{ movieTitle }}</h4>
                <p class="text">
                  {{  movieDescription }}
                </p>
              </div>
            </div>
          </section>

          <section class="section--center mdl-grid mdl-grid--no-spacing mdl-shadow--2dp question-section">
            <div class="mdl-card mdl-cell mdl-cell--12-col">
              <div class="mdl-card__supporting-text">
                <div v-show="pageType === 'question'">
                  <h4> {{questions[questionIdx]}} </h4>
                  <table class="mdl-data-table mdl-shadow--2dp question-table">
                    <thead>
                      <tr>
                        <th class="mdl-data-table__cell--non-numeric">Tag</th>
                        <th class="mdl-data-table__cell--non-numeric">{{tableHeader[questionIdx] + "?"}}</th>
                      </tr>
                    </thead>
                    <tbody v-if="questionIdx < 2">
                      <tr v-for="tag in tagsShown">
                        <td class="mdl-data-table__cell--non-numeric table-text">{{ tag.name }}</td>
                        <td>
                          <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">
                            <input type="checkbox" class="mdl-checkbox__input" v-model="tag[tableHeader[questionIdx]]">
                          </label>
                        </td>
                      </tr>
                    </tbody>
                    <tbody v-else>
                      <tr v-for="tag in tagsShown | goodTag tableHeader">
                        <td class="mdl-data-table__cell--non-numeric table-text">{{ tag.name }}</td>
                        <td>
                          <label  class="mdl-radio mdl-js-radio mdl-js-ripple-effect">
                            <input type="radio" class="mdl-radio__button" v-bind:value="tag.name" v-model="clusters[clusterIdx][tableHeader[questionIdx]]">
                          </label>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  <div class="nav-buttons">
                    {{clusterIdx + 1}} of {{clusters.length}}
                    <button v-on:click="clickOnNext()" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored button">
                      <i class="material-icons">arrow_forward</i>
                    </button>
                  </div>
                </div>
                <div v-show="pageType === 'transit'">
                  <h4>Next question...</h4>
                  <div class="nav-buttons">
                    <button v-on:click="clickOnNext()" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored button">
                      <i class="material-icons">arrow_forward</i>
                    </button>
                  </div>
                </div>
                <div v-show="pageType === 'finish'">
                  <h5> Thanks for completing the task! Leave you comments if you have any suggestion to this HIT.</h5>
                  <form action="#">
                    <div class="mdl-textfield mdl-js-textfield">
                      <textarea v-model="comment" class="mdl-textfield__input" type="text" rows= "3" id="comment"></textarea>
                      <label class="mdl-textfield__label" for="comment">Comments...</label>
                    </div>
                  </form>
                  {% endraw %}
                  {% include "simpleamt.html" %}
                </div>
            </div>
            </div>
          </section>
          <footer class="mdl-mega-footer">
            <div class="mdl-mega-footer--bottom-section">
            <div class="mdl-logo">
              Thank you!
            </div>
          </div>
          </footer>
      </main>
    </div>
    </div>

    <script>
    var DEFAULT_INPUT = {
      movieId: 123,
      movieTitle: "The Perks of Being a Wallflower",
      movieDescription: "A coming-of-age story based on the best-selling novel by Stephen Chbosky, which follows 15-year-old freshman Charlie, an endearing and naive outsider who is taken under the wings of two seniors. A moving tale of love, loss, fear and hope - and the unforgettable friends that help us through life.",
      posterSrc: "//image.tmdb.org/t/p/w185/s9R55JZF8g0WEqZvf7YWh4FZVYl.jpg",
      clusters: [{"tags": [{"name": "adolescence"}, {"name": "depression"}, {"name": "loneliness"}, {"name": "friendship"}, {"name": "suicide"}]}, {"tags": [{"name": "teenager"}, {"name": "teenagers"}, {"name": "mentor"}, {"name": "teens"}]}, {"tags": [{"name": "original"}]}],
    };
    var input = simpleamt.getInput(DEFAULT_INPUT);
    var vm = new Vue({
      el: '#app',
      data: {
        movieId: input.movieId,
        movieTitle: input.movieTitle,
        movieDescription: input.movieDescription,
        posterSrc: input.posterSrc,
        clusters: input.clusters,
        questions: [
          "1. The following table contains a group of related, descriptive tags about the movie above. Mark any tags that do not fit with the others. E.g., 'kids' does not fit with 'violence' and 'brutality'. If there are only two tags, and they describe very different aspects of the movie, please mark the one that is less relevant to the movie.",
          "2. Mark any tags that are potentially offensive or inappropriate for use in a family-oriented web site. E.g., 'suicide' and 'nudity' are inappropriate.",
          // Imagine that you want to persuade your friend to watch this movie. Which of the following tags are not appropriate to fill in the sentence 'you like movies featuring [Noun]' or 'you like [adjective] movies'?
          "3. Pick the tag that best represents the group of tags."
        ],
        tableHeader: [
          "Does not fit",
          "Inappropriate",
          "Best tag"
        ],
        questionIdx: 0,
        clusterIdx: 0,
        pageType: "question",
        comment: ""
      },
      created: function() {
        if (!simpleamt.isPreview()) {
          simpleamt.setupSubmit();
          $('#submit-btn').prop('disabled', false);
        }
        // Shallow copy tags shown and assign modified object back when clicking
        // on "next".
        // this.tagsShown = $.extend({}, this.clusters[0].tags);
      },
      computed: {
        tagsShown: function() {
          if (this.clusterIdx < this.clusters.length) {
            return this.clusters[this.clusterIdx].tags;
          }
          return [];
        }
      },
      methods: {
        clickOnNext: function() {
          if (this.pageType === "transit") {
            this.pageType = "question";
            return;
          }
          if (this.questionIdx == 2) {
            // Check if user has clicked on any radio button.
            filteredTags = goodTagFilterFun(this.clusters[this.clusterIdx].tags, this.tableHeader);
            if (filteredTags.length > 0
              && !this.clusters[this.clusterIdx].hasOwnProperty(this.tableHeader[2])) {
              alert("Please select the best tag.")
              return;
            }
          }
          this.clusterIdx += 1;
          if (this.clusterIdx >= this.clusters.length) {
            if (this.questionIdx == 2) {
              this.pageType = "finish";
              return;
            }
            this.questionIdx += 1;
            this.pageType = "transit";
          }
          this.clusterIdx %= this.clusters.length;
        },
      }
    });
    var goodTagFilterFun = function(array, headers) {
      return array.filter(function(value){
        result = true;
        for (var idx = 0; idx < headers.length; idx ++) {
          var header = headers[idx];
          result &= !value.hasOwnProperty(header) || !value[header];
        }
        return result;
      });
    }

    Vue.filter('goodTag', goodTagFilterFun);
    $(function() {
      $('#submit-btn').click(function() {
        console.log("submit!");
        console.log(vm.$data.clusters);
        simpleamt.setOutput({
          "movieId": vm.$data.movieId,
          "clusters": vm.$data.clusters,
          "comment": vm.$data.comment
        });
      })
    });
    </script>
  </body>
</html>
